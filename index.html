<!DOCTYPE html>
<html lang="en">
  <head>
     <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-WJFQ8DB381"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-WJFQ8DB381");
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="png" href="cipherx.png" />
    <title>CipherX</title>
    <style>
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

      #particleCanvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: -1;
      }

      @keyframes typewriter {
        from {
          width: 0;
        }

        to {
          width: 100%;
        }
      }

      @keyframes horrorEffect {
        0% {
          transform: scale(1);
          opacity: 1;
        }

        50% {
          transform: scale(1.5);
          opacity: 0.8;
        }

        100% {
          transform: scale(2);
          opacity: 0;
        }
      }

      @keyframes glitchEffect {
        0% {
          transform: translate(0);
        }

        20% {
          transform: translate(-3px, 3px);
        }

        40% {
          transform: translate(-3px, -3px);
        }

        60% {
          transform: translate(3px, 3px);
        }

        80% {
          transform: translate(3px, -3px);
        }

        100% {
          transform: translate(0);
        }
      }

      @keyframes glow {
        from {
          text-shadow: 0 0 8px #64ffda;
        }

        to {
          text-shadow: 0 0 15px #64ffda, 0 0 25px #64ffda;
        }
      }

      body.loading {
        overflow: hidden;
        height: 100vh;
      }

      body {
        min-height: 100vh;
        background-color: #0a192f;
        margin: 0;
        text-align: center;
        color: white;
        display: flex;
        flex-direction: column;
        font-family: Arial, sans-serif;
        opacity: 1;
        justify-content: space-evenly;
        align-items: center;
      }

      button {
        background: #06c4f8;
        font-weight: bold;
        color: white;
        font-size: 20px;
        height: 50px;
        border-radius: 5px;
        margin: 0 auto;
        min-width: 300px;
        font-family: Arial, sans-serif;
        border: none;
        cursor: pointer;
      }

      h2 {
      }

      .cont {
      }

      h1 {
        margin-top: px;
      }

      button {
        margin-top: 40px;
      }

      .cont p {
        font-weight: bold;
        padding: ;
        line-height: 150%;
      }
    </style>
  </head>

  <body>
    <div id="landingpage">
      <h1>CipherX</h1>
      <h2>Multi-Cipher Translation tool</h2>
      <div class="cont">
        <h3>Ciphers</h3>
        <p>Morse â€¢ Binary â€¢ Base64 â€¢ Caesar â€¢ Atbash â€¢ Reverse</p>

        <h3>Features</h3>
        <p>
          Convert text in a wide range of Cipher â€¢ Translation History â€¢ Theme
          Selector â€¢ Achievements â€¢ Stats â€¢ Personalized and Time Based Greeting
          â€¢ Multiple Share options â€¢ Awesome Easter Egg Rewards â€¢ Text to Speech
          options
        </p>
      </div>
      <button onclick="enterApp()">Get Started</button>
    </div>
    <div
      onclick="testVoice()"
      id="cipherLoader"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: #0a192f;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        color: #64ffda;
        font-family: monospace;
        overflow: hidden;
      "
    >
      <!-- Spinner -->
      <div
        id="loaderSpinner"
        style="
          width: 60px;
          height: 60px;
          border: 4px solid rgba(100, 255, 218, 0.3);
          border-top: 4px solid #64ffda;
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin-bottom: 30px;
        "
      ></div>

      <!-- Text container -->
      <div
        id="loaderText"
        style="font-size: 1.5em; text-align: center; min-height: "
      ></div>
      <canvas id="particleCanvas"></canvas>
      <!-- <button id="speech" onclick="testVoice()" style="display: ;"></button> -->
    </div>

    <script>
      const canvas = document.getElementById("particleCanvas");
      const ctx = canvas.getContext("2d");

      // Set canvas size
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      let cipherIndex = 0;

      // ðŸŽ¯ PARTICLE SYSTEM (Feature #4)
      const particles = [];
      function createParticles() {
        for (let i = 0; i < 300; i++) {
          particles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 3 + 1,
            speedX: Math.random() * 2 - 1,
            speedY: Math.random() * 2 - 1,
            color: `hsl(${Math.random() * 360}, 70%, 60%)`,
          });
        }
      }

      function animateParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((particle) => {
          ctx.fillStyle = particle.color;
          ctx.beginPath();
          ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
          ctx.fill();

          particle.x += particle.speedX;
          particle.y += particle.speedY;

          if (particle.x < 0 || particle.x > canvas.width)
            particle.speedX *= -1;
          if (particle.y < 0 || particle.y > canvas.height)
            particle.speedY *= -1;
        });
        requestAnimationFrame(animateParticles);
      }

      createParticles();
      animateParticles();

      function getTimeBasedGreeting() {
        const hour = new Date().getHours();

        if (hour < 12) return "Good Morning";
        if (hour < 17) return "Good Afternoon";
        return "Good Evening";
      }
      function format(str) {
        str = str.charAt(0).toUpperCase() + str.slice(1);
        return str;
      }
      function getLoaderSequence() {
        const userName = localStorage.getItem("userName");
        let achievementCount = Object.keys(localStorage).filter((key) =>
          key.startsWith("achievement_")
        ).length;
        achievementCount += Object.keys(localStorage).filter((key) =>
          key.startsWith("special")
        ).length;
        const history =
          JSON.parse(localStorage.getItem("translationHistory")) || [];
        const translations = history.length;
        let savedtheme = localStorage.getItem("theme") || "dark";
        savedtheme = format(savedtheme);
        console.log(savedtheme);
        // ðŸ†• USER - Personalized sequence
        if (userName) {
          return [
            { text: "Loading CipherX...", delay: 1500, effect: "typewriter" },
            {
              text: `${getTimeBasedGreeting()}`,
              delay: 1500,
              effect: "typewriter",
            },
            { text: `Loading theme engine`, delay: 1500, effect: "typewriter" },
            {
              text: `Restoring last theme style`,
              delay: 1500,
              effect: "typewriter",
            },
            {
              text: `Restored ${savedtheme} theme`,
              delay: 1500,
              effect: "typewriter",
            },
            {
              text: `Restoring translation history...`,
              delay: 1500,
              effect: "typewriter",
            },
            {
              text: `Restored ${translations} translations...`,
              delay: 1500,
              effect: "typewriter",
            },
            {
              text: `Restoring: Achievement system`,
              delay: 1500,
              effect: "typewriter",
            },
            {
              text: `Restored: ${achievementCount}/8 completed achievements`,
              delay: 1500,
              effect: "typewriter",
            },
            {
              text: "âš¡ Synchronizing cipher databases...",
              delay: 1500,
              effect: "typewriter",
            },
            {
              text: "Cipher protocols activeâœ“",
              delay: 1500,
              effect: "typewriter",
            },
            { text: `System secured`, delay: 1500, effect: "typewriter" },
            {
              text: "UNEXPECTED ENCRYPTION ACTIVITY DETECTED",
              delay: 1500,
              effect: "horror",
            },
            { text: `Welcome back ${userName}!`, delay: 1500, effect: "final" },
          ];
        }

        // ðŸ†• USER - First-time sequence
        return [
          {
            text: "Initializing CipherX...",
            delay: 1500,
            effect: "typewriter",
          },
          {
            text: `${getTimeBasedGreeting()}`,
            delay: 1500,
            effect: "typewriter",
          },
          {
            text: "Loading: Morse â€¢ Binary â€¢ Base64 â€¢ Caesar â€¢ Atbash â€¢ Reverse",
            delay: 1500,
            effect: "typewriter",
          },
          {
            text: "Preparing translation engine...",
            delay: 1500,
            effect: "typewriter",
          },
          {
            text: "Initializing achievement system...",
            delay: 1500,
            effect: "typewriter",
          },
          {
            text: "Loading theme engine...",
            delay: 1500,
            effect: "typewriter",
          },
          {
            text: "Initializing translation history...",
            delay: 1500,
            effect: "typewriter",
          },
          {
            text: "UNEXPECTED ENCRYPTION ACTIVITY DETECTED",
            delay: 1500,
            effect: "horror",
          },
          {
            text: "System secured. Ready to begin!",
            delay: 1000,
            effect: "final",
          },
        ];
      }

      function startEpicLoader() {
        const loader = document.getElementById("cipherLoader");
        const textElement = document.getElementById("loaderText");
        const spinner = document.getElementById("loaderSpinner");
        loader.style.display = "flex";

        // Sequence of messages with delays
        const sequence = getLoaderSequence();

        let currentIndex = 0;

        function showNextMessage() {
          if (currentIndex >= sequence.length) {
            // End of sequence - hide loader
            hideLoader();
            window.location.href = "app.html";
            return;
          }

          const { text, delay, effect } = sequence[currentIndex];
          textElement.innerHTML = "";

          switch (effect) {
            case "typewriter":
              typewriterEffect(text, delay);
              break;
            case "horror":
              horrorEffect(text, delay);
              break;
            case "final":
              finalEffect(text, delay);
              break;
          }

          currentIndex++;
        }

        function typewriterEffect(text, delay) {
          let i = 0;
          textElement.style.overflow = "hidden";
          textElement.style.whiteSpace = "nowrap";
          textElement.style.borderRight = "1px solid #64ffda";

          function type() {
            if (i < text.length) {
              textElement.innerHTML += text.charAt(i);
              i++;
              setTimeout(type, 50);
            } else {
              textElement.style.borderRight = "none";
              setTimeout(showNextMessage, delay);
            }
          }
          type();
        }

        function horrorEffect(text, delay) {
          textElement.innerHTML = text;
          textElement.style.color = "#ff4757";
          textElement.style.fontWeight = "bold";
          textElement.style.animation = "glitchEffect 0.5s infinite";

          // Make spinner red and faster
          spinner.style.borderTopColor = "#ff4757";
          spinner.style.animation = "spin 0.3s linear infinite";

          setTimeout(() => {
            textElement.style.animation = "horrorEffect 1s forwards";
            spinner.style.animation = "horrorEffect 1s forwards";
            setTimeout(showNextMessage, 1000);
          }, delay);
        }

        function finalEffect(text, delay) {
          // Reset styles
          textElement.style.animation = "";
          textElement.style.color = "#64ffda";
          spinner.style.animation = "spin 1s linear infinite";
          spinner.style.borderTopColor = "#64ffda";
          spinner.style.opacity = "1";
          spinner.style.transform = "scale(1)";
          textElement.innerHTML = text;

          setTimeout(() => {
            hideLoader();
          }, 5000);
        }
        function hideLoader() {
          loader.style.animation = "fadeOut 1s forwards";
          setTimeout(() => {
            loader.style.display = "none";
          }, 1000);
        }

        // Start the sequence
        showNextMessage();
      }

      // Add fadeOut animation
      const style = document.createElement("style");
      style.textContent = `
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; visibility: hidden; }
    }
`;
      document.head.appendChild(style);

      if (localStorage.getItem("userName")) {
        // Show loader immediately for returning users
        document.getElementById("landingpage").style.display = "none";
        startEpicLoader();

        setTimeout(() => {
          window.location.href = "app.html";
        }, 40000); // Shorter delay for returning users
      } else {
        document.getElementById("landingpage").style.display = "block";
      }
      function enterApp() {
        document.getElementById("cipherLoader").style.display = "flex";
        document.getElementById("landingpage").style.display = "none";
        // Set flag and redirect after a brief delay for smoothness
        startEpicLoader();

        setTimeout(() => {
          window.location.href = "app.html";
        }, 30000); // 1 second delay to show loader
      }
      // GLOBAL VARIABLES
      let availableVoices = []; // This will hold all voices
      let defaultVoice = null; // This will hold our chosen voice (Samantha!)

      // This function runs when voices are loaded
      function findSamantha(voices) {
        // Look for her by name across different systems
        return voices.find(
          (voice) =>
            voice.name.includes("Samantha") ||
            voice.name.includes("Google UK English Female") || // Good fallback
            voice.name.includes("Google US English Female") || // Good fallback
            voice.name.includes("Microsoft Zira Desktop") // Good fallback
        );
      }
      function loadVoices() {
        availableVoices = window.speechSynthesis.getVoices();
        console.log("Voices loaded:", availableVoices);

        // NOW we try to find Samantha
        defaultVoice = findSamantha(availableVoices);

        if (defaultVoice) {
          console.log("ðŸŽ‰ Default voice set to:", defaultVoice.name);
        } else {
          console.warn("Samantha not found. Using system default.");
          // If we can't find her, the system will use its default anyway
        }
      }

      // A dedicated function to find our queen

      // CHECK IF VOICES ARE ALREADY LOADED (e.g., on a button click later)
      if (window.speechSynthesis.getVoices().length > 0) {
        loadVoices();
      }
      // LISTEN FOR THE EVENT WHEN VOICES ARE LOADED
      window.speechSynthesis.onvoiceschanged = loadVoices;

      function testVoice() {
        // Check if browser supports speech
        if (!("speechSynthesis" in window)) {
          alert("Speech synthesis not supported in your browser");
          return;
        }

        window.speechSynthesis.cancel();
        // Get the username from localStorage or use default
        const userName = localStorage.getItem("userName");

        // Create the message
        const message = userName
          ? `${getTimeBasedGreeting()} ${userName}, Welcome back`
          : `${getTimeBasedGreeting()}, Welcome to Cipher X`;

        // Create speech object
        const utterance = new SpeechSynthesisUtterance(message);

        // 1. FIRST PRIORITY: Use the pre-loaded global defaultVoice (Samantha!)
        if (defaultVoice) {
          utterance.voice = defaultVoice;
          console.log("Welcome: Using pre-loaded voice:", defaultVoice.name);
        } else {
          // 2. FALLBACK: Voices haven't loaded via the event yet, try to grab them now.
          const voices = window.speechSynthesis.getVoices();
          const fallbackVoice = findSamantha(voices); // Use the same finder function

          if (fallbackVoice) {
            utterance.voice = fallbackVoice;
            console.log("Welcome: Using fallback voice:", fallbackVoice.name);
          } else {
            // 3. LAST RESORT: No Samantha found. Use fun tweaks on the default male voice.
            console.log(
              "Welcome: No preferred voice found. Applying fun tweaks to default."
            );
            utterance.rate = 1.1;
            utterance.pitch = 1.4;
          }
        }

        // Apply base properties (these work on any voice)
        utterance.volume = 1;

        // Speak it!
        window.speechSynthesis.speak(utterance);

        // Callback when finished
        utterance.onend = function () {
          console.log("Finished speaking welcome message");
        };
      }
    </script>
  </body>
</html>
